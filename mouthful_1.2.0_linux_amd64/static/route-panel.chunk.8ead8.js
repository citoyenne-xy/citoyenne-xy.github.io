webpackJsonp([0],{"6Bts":function(t,e,n){"use strict";function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return new Date(t).toISOString().slice(0,19).replace("T"," ")}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c=n("KM04"),f=n("HzJC"),m=n.n(f),p=function(t){function e(e){var n=o(this,t.call(this,e));return n.reload=n.reload.bind(n),n.deleteComment=n.deleteComment.bind(n),n.undoDelete=n.undoDelete.bind(n),n.handleBodyChange=n.handleBodyChange.bind(n),n.handleAuthorChange=n.handleAuthorChange.bind(n),n}return u(e,t),e.prototype.handleAuthorChange=function(t,e){this.props.comments.find(function(e){return e.Id==t})&&this.props.updateComment(t,null,e,null)},e.prototype.handleBodyChange=function(t,e){this.props.comments.find(function(e){return e.Id==t})&&this.props.updateComment(t,e,null,null)},e.prototype.reload=function(){this.props.reload()},e.prototype.deleteComment=function(t,e){if("undefined"!=typeof window){var n=new XMLHttpRequest;n.open("DELETE",this.props.url+"v1/admin/comments",!0);var o=this;n.onreadystatechange=function(){if(4==n.readyState&&204==n.status){var e=o.props.comments.filter(function(e){return e.Id!=t});o.setState({comments:e}),o.reload()}else o.reload()},n.send(!0===e?JSON.stringify({CommentId:t,Hard:!0}):JSON.stringify({CommentId:t}))}},e.prototype.undoDelete=function(t){if("undefined"!=typeof window){var e=new XMLHttpRequest;e.open("POST",this.props.url+"v1/admin/comments/restore",!0);var n=this;e.onreadystatechange=function(){if(4==e.readyState&&204==e.status){var o=n.props.comments.filter(function(e){return e.Id!=t});n.setState({comments:o}),n.reload()}else n.reload()},e.send(JSON.stringify({CommentId:t}))}},e.prototype.render=function(){var t=this,e="";return e=0==this.props.comments.filter(function(t){return null==t.ReplyTo&&null==t.DeletedAt}).length?this.props.comments.map(function(e){return Object(c.h)("div",{class:m.a.mouthful_comment,key:"___comment"+e.Id},Object(c.h)("div",null,Object(c.h)("input",{class:m.a.mouthful_author_input,type:"text",value:e.Author,onChange:function(n){t.handleAuthorChange(e.Id,n.target.value)}}),Object(c.h)("span",{class:m.a.mouthful_date},a(e.CreatedAt))),Object(c.h)("div",null,Object(c.h)("textarea",{class:m.a.mouthful_comment_input,value:e.Body,onChange:function(n){t.handleBodyChange(e.Id,n.target.value)}})),Object(c.h)("div",{class:m.a.buttons},Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,e.Body,e.Author,e.Confirmed)}},"Update"),null==e.DeletedAt?Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.deleteComment(e.Id)}},"Delete"):Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.undoDelete(e.Id)}},"Undo delete"),e.Confirmed?"":Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,null,null,!0)}},"Confirm"),null!=e.DeletedAt?Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.deleteComment(e.Id,!0)}},"Hard delete"):null))}):this.props.comments.filter(function(t){return null==t.ReplyTo||null!=t.DeletedAt}).map(function(e){var n=t.props.comments.filter(function(t){return t.ReplyTo===e.Id}).map(function(e){return Object(c.h)("div",{class:m.a.mouthful_comment_reply,key:"___comment"+e.Id},Object(c.h)("div",null,Object(c.h)("input",{class:m.a.mouthful_author_input,type:"text",value:e.Author,onChange:function(n){t.handleAuthorChange(e.Id,n.target.value)}}),Object(c.h)("span",{class:m.a.mouthful_date},a(e.CreatedAt))),Object(c.h)("div",null,Object(c.h)("textarea",{class:m.a.mouthful_comment_input,value:e.Body,onChange:function(n){t.handleBodyChange(e.Id,n.target.value)}})),Object(c.h)("div",null,Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,e.Body,e.Author,e.Confirmed)}},"Update"),null==e.DeletedAt?Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.deleteComment(e.Id)}},"Delete"):Object(c.h)("div",{class:m.a.smallButton,onClick:function(){return t.undoDelete(e.Id)}},"Undo delete"),e.Confirmed?"":Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,null,null,!0)}},"Confirm")))});return Object(c.h)("div",{class:m.a.mouthful_comment,key:"___comment"+e.Id},Object(c.h)("div",null,Object(c.h)("input",{class:m.a.mouthful_author_input,type:"text",value:e.Author,onChange:function(n){t.handleAuthorChange(e.Id,n.target.value)}}),Object(c.h)("span",{class:m.a.mouthful_date},a(e.CreatedAt))),Object(c.h)("div",null,Object(c.h)("textarea",{class:m.a.mouthful_comment_input,value:e.Body,onChange:function(n){t.handleBodyChange(e.Id,n.target.value)}})),Object(c.h)("div",null,Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,e.Body,e.Author,e.Confirmed)}},"Update"),null==e.DeletedAt?Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.deleteComment(e.Id,!1)}},"Delete"):Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.undoDelete(e.Id)}},"Undo delete"),e.Confirmed?"":Object(c.h)("div",{class:m.a.mouthful_reply_button,onClick:function(){return t.props.updateComment(e.Id,null,null,!0)}},"Confirm")),Object(c.h)("div",{style:"margin-left:30px"},n))}),e.length>0?Object(c.h)("div",{class:"thread"},Object(c.h)("h2",null,this.props.thread.Path),Object(c.h)("div",{class:"comments"},e)):null},e}(c.Component),_=function(t){function e(n){i(this,e);var o=l(this,t.call(this,n));return o.state={value:""},o.onLogin=n.onLogin,o.handleChange=o.handleChange.bind(o),o.handleSubmit=o.handleSubmit.bind(o),o.handleOauthClick=o.handleOauthClick.bind(o),o}return r(e,t),e.prototype.handleOauthClick=function(t){window.location.replace(this.props.url+"v1/oauth/auth/"+t)},e.prototype.handleChange=function(t){this.setState({value:t.target.value})},e.prototype.handleSubmit=function(t){var e=this;t.preventDefault();var n=new XMLHttpRequest;n.open("POST",this.props.url+"v1/admin/login",!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=function(){4==n.readyState&&204==n.status&&e.onLogin()},n.send(JSON.stringify({password:e.state.value}))},e.prototype.render=function(){var t=this,e=Object(c.h)("form",{onSubmit:this.handleSubmit},Object(c.h)("label",{class:m.a.passwordTitle},"Password:"),Object(c.h)("input",{type:"password",value:this.state.value,onChange:this.handleChange}),Object(c.h)("input",{class:m.a.mouthful_submit,type:"submit",value:"Submit"})),n=this.props.config.disablePasswordLogin?null:e,o=this.props.config.oauthProviders&&this.props.config.oauthProviders.length>0?this.props.config.oauthProviders.map(function(e){return Object(c.h)("li",{class:m.a.mouthful_admin_li},Object(c.h)("a",{class:m.a.mouthful_admin_oauth_a,onClick:function(){return t.handleOauthClick(e)}},"Log in with ",e))}):null,u=Object(c.h)("div",null,Object(c.h)("ul",null,o));return Object(c.h)("div",{class:m.a.mouthful_login},n,u)},e}(c.Component);n.d(e,"default",function(){return v});var b=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},y=function(t,e,n){if(4==t.readyState&&200==t.status){var o={loaded:!0,authorized:!0};o[n]=JSON.parse(t.responseText),e.setState(o)}else 4==t.readyState&&401==t.status&&e.setState({authorized:!1,loaded:!0})},g=function(t,e){if(t.path)return e.location.origin+t.path;var n=e.location.href.indexOf("v1/oauth");return n>0?e.location.href.substring(0,n):e.location.href},v=function(t){function e(){s(this,e);var n=h(this,t.call(this));return n.state={threads:[],comments:[],error:!1,authorized:!1,loaded:!1,showPending:!0,showDeleted:!1,configLoaded:!1,config:{},path:void 0},n.loadThreads=n.loadThreads.bind(n),n.loadComments=n.loadComments.bind(n),n.loggedIn=n.loggedIn.bind(n),n.showPending=n.showPending.bind(n),n.hidePending=n.hidePending.bind(n),n.reload=n.reload.bind(n),n.showDeleted=n.showDeleted.bind(n),n.updateComment=n.updateComment.bind(n),n.fetchConfig=n.fetchConfig.bind(n),n}return d(e,t),e.prototype.showPending=function(){this.setState({showPending:!0}),this.setState({showDeleted:!1})},e.prototype.hidePending=function(){this.setState({showPending:!1}),this.setState({showDeleted:!1})},e.prototype.showDeleted=function(){this.setState({showPending:!1}),this.setState({showDeleted:!0})},e.prototype.loadThreads=function(t){if("undefined"!=typeof window){var e=new XMLHttpRequest,n=g(this.state,window)+"v1/admin/threads";e.open("GET",n,!0),e.onreadystatechange=function(){y(e,t,"threads")},e.send()}},e.prototype.loadComments=function(t){if("undefined"!=typeof window){var e=new XMLHttpRequest,n=g(this.state,window)+"v1/admin/comments/all";e.open("GET",n,!0),e.onreadystatechange=function(){y(e,t,"comments")},e.send()}},e.prototype.updateComment=function(t,e,n,o){if("undefined"!=typeof window){var u=new XMLHttpRequest,a=g(this.state,window)+"v1/admin/comments";u.open("PATCH",a,!0);var i=this;u.onreadystatechange=function(){i.reload()},u.send(JSON.stringify({CommentId:t,Body:e,Author:n,Confirmed:o}))}},e.prototype.loggedIn=function(){this.setState({authorized:!0}),this.setState({loaded:!1})},e.prototype.fetchConfig=function(){if("undefined"!=typeof window){var t=this,e=new XMLHttpRequest,n=g(this.state,window)+"v1/admin/config";e.open("GET",n,!0),e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){var n=JSON.parse(e.responseText);t.setState({configLoaded:!0,config:b(t.state.config,n),path:n.path})}else t.setState({configLoaded:!0,error:!0}),console.log("error while fetching config")},e.send()}},e.prototype.reload=function(){this.setState({loaded:!1,threads:[],comments:[]})},e.prototype.componentWillMount=function(){this.loggedIn(),this.state.configLoaded||this.fetchConfig()},e.prototype.render=function(){var t=this;if(!this.state.authorized){var e=g(this.state,window);return Object(c.h)("div",{class:m.a.mouthful_container},Object(c.h)(_,{url:e,onLogin:this.loggedIn,config:this.state.config}))}if(this.state.loaded||(this.loadThreads(this),this.loadComments(this)),1==this.state.error)return Object(c.h)("div",{class:m.a.mouthful_container},Object(c.h)("div",{class:m.a.mouthful_login},"There was an error while fetching the config"));if(!(this.state.threads&&this.state.comments&&this.state.threads.length&&this.state.comments.length))return Object(c.h)("div",{class:m.a.mouthful_container},Object(c.h)("div",{class:m.a.mouthful_login},"No comments yet!"));var n=this.state.threads.sort(function(t,e){return t=new Date(t.CreatedAt),e=new Date(e.CreatedAt),t>e?-1:t<e?1:0}).map(function(e){var n=t.state.comments,o=function(t){return!t.Confirmed&&null==t.DeletedAt},u=function(t){return null==t.DeletedAt},a=function(t){return null!=t.DeletedAt},i=n.filter(function(t){return t.ThreadId==e.Id}),l=t.state.showPending?o:u;return l=t.state.showDeleted?a:l,i=i.filter(l),0!=i.length?Object(c.h)(p,{url:g(t.state,window),key:"___thread"+e.Id,thread:e,comments:i,reload:t.reload,updateComment:t.updateComment}):null}),o=n.filter(function(t){return null!=t}).length>0?n:Object(c.h)("div",{class:m.a.nothing},"Nothing to display");return Object(c.h)("div",{class:m.a.mouthful_container},Object(c.h)("div",{class:m.a.mouthful_wrapper},Object(c.h)("div",{class:m.a.mouthful_buttons},Object(c.h)("div",{class:this.state.showPending?m.a.mouthful_buttonActive:m.a.mouthful_button,onClick:this.showPending},"Show unconfirmed"),Object(c.h)("div",{class:0==this.state.showPending&&0==this.state.showDeleted?m.a.mouthful_buttonActive:m.a.mouthful_button,onClick:this.hidePending},"Show all"),Object(c.h)("div",{class:this.state.showDeleted?m.a.mouthful_buttonActive:m.a.mouthful_button,onClick:this.showDeleted},"Show deleted")),Object(c.h)("div",null,o)))},e}(c.Component)},HzJC:function(t){t.exports={mouthful_wrapper:"mouthful_wrapper__3WEzv",mouthful_login:"mouthful_login__fadGC",mouthful_button:"mouthful_button__E2hr2",mouthful_buttonActive:"mouthful_buttonActive__1vLuv",mouthful_buttons:"mouthful_buttons__bbuNt",mouthful_container:"mouthful_container__1eO2q",mouthful_date:"mouthful_date__2Mv2_",nothing:"nothing__3OSja",passwordTitle:"passwordTitle__229oE",mouthful_submit:"mouthful_submit__1oO5q",mouthful_reply_button:"mouthful_reply_button__MesQM",mouthful_moderation:"mouthful_moderation__2FkCO",mouthful_comment:"mouthful_comment__2hEiv",mouthful_comment_reply:"mouthful_comment_reply__3ZjGX",mouthful_author:"mouthful_author__NHLrx",mouthful_comment_body:"mouthful_comment_body__y4ISK",mouthful_form:"mouthful_form__xH6p9",mouthful_form_invisible:"mouthful_form_invisible__85EZm",mouthful_author_input:"mouthful_author_input__wgG2y",mouthful_comment_input:"mouthful_comment_input__2YJ0O",mouthful_admin_li:"mouthful_admin_li__MWHSz",mouthful_admin_oauth_a:"mouthful_admin_oauth_a__2rCPY"}}});
//# sourceMappingURL=route-panel.chunk.8ead8.js.map